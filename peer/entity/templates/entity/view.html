{% extends "base.html" %}

{% load i18n account entity_permissions %}

{% block extracss %}
<link type="text/css" href="{{ STATIC_URL }}css/flags.css" rel="Stylesheet" />
{% endblock %}

{% block content %}
{% canedit entity %}{% include "entity/menu.html" %}{% endcanedit %}
<section class="mainContent">

  <hgroup>
    <h1>{% trans "Entity details" %}</h1>
    <h2>{{ entity.name }}</h2>
  </hgroup>

  {% if entity.owner %}
  <p>{% trans "Owned by" %} {% safefullname entity.owner %}</p>
  {% endif %}

  {% with entity.delegates.all as delegates %}
  {% if delegates %}
  <p>{% trans "People that can edit it" %}:
    {% for delegate in delegates %}
      {% safefullname delegate %}{% if not forloop.last %}, {% endif %}
    {% endfor %}
  </p>
  {% endif %}
  {% endwith %}

  {% if entity.has_metadata %}
    <dl>
      {% if entity.entityid %}
      <dt class="ui-icon ui-icon-comment" title="{% trans "EntityID" %}">{% trans "EntityID" %}</dt>
      <dd>{{ entity.entityid }}</dd>
      {% endif %}

      {% if entity.endpoints %}
      <dt class="ui-icon ui-icon-link" title="{% trans "Endpoints" %}">{% trans "Endpoints" %}</dt>
      <dd>
        <table>
          <tbody>
          {% for endpoint in entity.endpoints %}
          <tr>
            <td><a href="{{ endpoint.Location }}">{{ endpoint.Location }}</a></td>
            <td>({{ endpoint.Type }})</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </dd>
      {% endif %}

      {% if entity.contacts %}
      <dt class="ui-icon ui-icon-person" title="{% trans "Contacts" %}">{% trans "Contacts" %}</dt>
      <dd>
        <table>
          <tbody>
          {% for contact in entity.contacts %}
          <tr>
            <td>{{ contact.GivenName }} {{ contact.SurName }}</td>
            <td>({{ contact.type }} {% trans "contact type" %})</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </dd>
      {% endif %}

      {% if entity.organization %}
      <dt class="ui-icon ui-icon-suitcase" title="{% trans "Organization" %} {{ l10n_org.lang }}">{% trans "Organization" %} {{ l10n_org.lang }}</dt>
      <dd>
        <table>
          <tbody>
          {% for l10n_org in entity.organization %}
          <tr>
            {% if l10n_org.URL %}
            <td><a href="{{ l10n_org.URL }}">{{ l10n_org.displayName }}</a></td>
            <td><span class="flag {{ l10n_org.lang }}" title="{{ l10n_org.lang }}" /></td>
            {% else %}
            <td>{{ l10n_org.displayName }}</td>
            <td><span class="flag {{ l10n_org.lang }}" title="{{ l10n_org.lang }}" /></td>
            {% endif %}
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </dd>
      {% endif %}

      {% if entity.certificates %}
      <dt class="ui-icon ui-icon-key" title="{% trans "Certificates" %}">{% trans "Certificates" %}</dt>
      <dd>
        <ul>
          {% for certificate in entity.certificates %}
          <li>{{ certificate }}</li>
          {% endfor %}
        </ul>
      </dd>
      {% endif %}

      <dt class="ui-icon ui-icon-signal-diag" title="{% trans "Changes feed" %}">{% trans "Changes feed" %}</dt>
      <dd><a href="">Changes feed</a></dd>
    </dl>

    <div class="history">
      <h2 class="clear"><span class="left ui-icon ui-icon-triangle-1-e"></span><a href="#">View history</a></h2>
      <table>
        <thead>
          <tr>
            <th>Diff</th>
            <th>Rev</th>
            <th>Date</th>
            <th>Author</th>
            <th>Log message</th>
          </tr>
        </thead>
        <tbody>
          {% for rev in revs %}
          <tr class="{% cycle "odd" "even" %}">
            {% if rev.previous %}
            <td><a href="#">Prev diff</a></td>
            {% endif %}
            <td><a href="#">@{{ rev.versionid }}</a></td>
            <td>{{ rev.date }}</td>
            <td>{{ rev.author }}</td>
            <td>{{ rev.message }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  {% else %}
    <div>{% trans "This entity has no associated metadata yet." %}</div>
  {% endif %}

</section>
{% endblock %}
